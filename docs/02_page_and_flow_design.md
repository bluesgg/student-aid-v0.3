# 02 页面与流程设计

> 本文为 StudentAid Web 的页面与流程设计文档，配合 `01_light_prd.md` 的最新 AI 讲解规则进行了同步更新，尤其是 P5「PDF 阅读 & AI 学习页」的「解释当前页 / 贴纸 / 问答 / 总结」相关交互。

---

## 1. 页面列表总览

| 页面ID | 页面名称                | 路径 URL                               | 说明                                               |
| ---- | ------------------- | ------------------------------------ | ------------------------------------------------ |
| P1   | 登录页（含注册入口）          | `/login`                             | 未登录用户入口，支持邮箱+密码登录，并引导到注册页                        |
| P2   | 注册页                 | `/register`                          | 新用户注册账号，完成后跳转到「我的课程」列表                           |
| P3   | 我的课程列表页（My Courses） | `/courses`                           | 展示当前用户的课程卡片，可新建 / 编辑 / 删除课程                      |
| P4   | 课程详情 & 资料中心         | `/courses/[courseId]`                | 按 Lecture / Homework / Exam / Other 分组展示课程所有 PDF |
| P5   | PDF 阅读 & AI 学习页     | `/courses/[courseId]/files/[fileId]` | 左侧 PDF 阅读器，右侧 AI 面板（自动讲解 / 选中讲解 / 问答 / 总结）       |
| P6   | 课程级复习提纲页（可为弹层）      | `/courses/[courseId]/outline`        | 展示整门课程的复习提纲，可从课程详情页进入                            |
| P7   | 账号配额与使用情况页（可选）      | `/account/usage`                     | 查看课程数量上限与各类 AI 配额使用情况                            |

> 说明：P6、P7 可以实现为独立路由页面，或在 P4 内以抽屉 / 弹层形式承载；此处按独立页面标注，便于产品与前端实现时统一导航与埋点。

---

## 2. P1 登录页（`/login`）

### 2.1 页面目标与入口

* **目标**：

  * 让用户以最低成本完成登录，进入课程列表；
  * 对未注册用户给出清晰的注册入口。
* **入口**：

  * 未登录用户访问任意受保护页面时自动跳转；
  * 用户主动在地址栏输入 `/login`。

### 2.2 布局结构（示意）

* 左侧：品牌 / 产品介绍（可选，MVP 可仅展示产品名和一句话描述）
* 右侧：登录表单区域

  * 邮箱输入框
  * 密码输入框
  * 「Sign in」按钮
  * 跳转注册页链接（"Don't have an account? Sign up."）

### 2.3 交互与状态

* 用户输入邮箱 + 密码，点击「Sign in」：

  * 校验通过 → 创建会话，跳转 P3「我的课程列表页」；
  * 校验失败 → 在表单下方显示错误文案 `"Incorrect email or password. Please try again."`；
* 正在登录时按钮进入 loading 状态，避免重复点击；
* 已登录用户再次访问 `/login` 时自动重定向到 `/courses`。

---

## 3. P2 注册页（`/register`）

### 3.1 页面目标与入口

* **目标**：

  * 为新用户提供简洁注册流程；
  * 收集最小必要信息，快速进入产品主流程。
* **入口**：

  * P1 登录页中的「Sign up」链接；
  * 直接访问 `/register`。

### 3.2 表单字段与规则

* 邮箱（Email）

  * 必填，需符合邮箱格式；
  * 若邮箱已注册，注册提交时提示 `"This email is already registered. Please sign in instead."`。
* 密码（Password）

  * 必填，最小长度（例如 ≥ 8 字符）；
  * 不要求复杂密码规则（MVP 阶段）。
* 可选字段：学校 / 姓名（可留待后续版本再加入）。

### 3.3 提交与跳转

* 用户填写邮箱 + 密码，点击「Create account」：

  * 后端创建账号成功 → 自动登录并跳转 P3；
  * 若邮箱已存在 → 显示错误提示，并给出跳转登录页链接。

---

## 4. P3 我的课程列表页（`/courses`）

### 4.1 页面目标与入口

* **目标**：

  * 展示用户的课程概览；
  * 作为管理课程（创建 / 编辑 / 删除）和进入课程详情的中心入口。
* **入口**：

  * 登录 / 注册成功后默认跳转；
  * 全局导航中的「My Courses」。

### 4.2 布局结构（示意）

* 顶部：标题「My Courses」+ 新建课程按钮「New course」
* 主体：课程卡片网格（Grid）

  * 每个卡片显示：

    * 课程名称（必填，主标题）
    * 学校 / 学期（可选，小字显示）
    * 已上传 PDF 数量（如「8 files」）
  * 卡片点击区域：进入 P4 课程详情页
  * 卡片右上角更多操作菜单（…）：

    * 「Edit course」
    * 「Delete course」
* 空状态：

  * 文案："You don't have any courses yet."
  * 引导按钮："Create your first course"

### 4.3 交互与配额提示

* 点击「New course」：

  * 若未达配额上限 → 弹出创建课程对话框（见 F1 流程）；
  * 若已达配额上限 → 按钮禁用或点击后弹出说明：

    * `"For this experiment, you can create up to 6 courses."`
* 删除课程：

  * 点击「Delete」→ 二次确认弹框：

    * `"Are you sure you want to delete this course? This will also delete all uploaded materials for this course."`
  * 确认后执行删除，列表实时更新。

---

## 5. P4 课程详情 & 资料中心（`/courses/[courseId]`）

### 5.1 页面目标与入口

* **目标**：

  * 对单门课程下所有 PDF 进行结构化展示；
  * 作为进入各个 PDF 学习页（P5）的跳板；
  * 支持上传新资料并维护文件类型。
* **入口**：

  * P3 课程卡片点击进入；
  * 从 P5 返回上一级。

### 5.2 布局结构（示意）

* 顶部：面包屑 + 课程名

  * 面包屑示例：`My Courses / Calculus I`
* 右上角：操作区域

  * 「Upload PDF」按钮
  * 「Generate course outline」（课程级提纲，跳转 / 弹层到 P6）
* 主体：按类型分组的文件列表

  * 分组标题：Lecture notes / Homework / Exams / Other materials
  * 每个分组下为 PDF 文件卡片列表：

    * 文件名
    * 页数（如「23 pages」）
    * 上传时间
    * 类型标签（可编辑）
    * 入口按钮 / 整个卡片点击 → 跳转 P5

### 5.3 交互细节

* 点击「Upload PDF」：

  * 打开上传对话框（多文件选择），支持拖拽；
  * 为每个文件指定类型（默认 Lecture，可下拉修改为 Homework / Exam / Other）；
  * 检查同名冲突：

    * 若课程下已存在同名文件，提示 `"A file named 'XXX' already exists in this course."`，需更改文件名或取消上传；
  * 上传过程中显示进度条；
  * 上传成功后自动解析页数并显示在对应分组。
* 修改文件类型：

  * 文件卡片上提供类型下拉菜单；
  * 修改后本地 UI 即时更新，并同步到后端。
* 删除文件（MVP 可选）：

  * 在文件卡片的更多操作菜单中提供「Delete file」；
  * 删除时弹出确认提示。

---

## 6. P5 PDF 阅读 & AI 学习页（`/courses/[courseId]/files/[fileId]`）

### 6.1 页面目标与入口

* **目标**：提供「阅读 PDF + 即时 AI 讲解 / 贴纸 / 问答 / 总结」的一体化学习空间，支撑整学期跟课与考前冲刺。
* **入口**：

  * P4 课程详情页中点击任一 PDF 卡片；
  * P6 课程提纲页中点击某个章节 / 小结条目跳转到对应 PDF + 页码（可选）。

### 6.2 布局结构（示意）

* **整体布局**：左右两栏结构

  * 左侧：内嵌 PDF 阅读器区域；
  * 右侧：AI 学习区域（上部为讲解贴纸栏，下部为问答 / 总结区域）。

* **左侧 PDF 区域**：

  * 浏览模式：分页模式（单页） / Scroll 连续滚动模式；
  * 控件：上一页 / 下一页、页码输入跳转、页数显示、缩放控制；
  * 状态记忆：记录当前文件的 `lastReadPage`，存储到后端；
  * 与贴纸的联动：

    * 点击某条贴纸时，左侧滚动到对应页 / 锚点，并短暂高亮对应内容；
    * 反向联动（可选）：鼠标悬停某段文本时，在右侧弱提示对应贴纸。

* **右侧 AI 区域**（上下分区，MVP 可固定比例）：

  1. **讲解贴纸栏（上半部分）**

     * 垂直列表显示当前文件的 AI 讲解贴纸；
     * 贴纸随整体滚动，尽量与左侧页面 / 段落在竖直方向保持对应；
     * 支持折叠 / 展开、按来源类型（自动 / 手动）区分样式；
     * 单条贴纸内容区高度有限，超出部分在贴纸内部滚动。
  2. **问答 / 总结区域（下半部分）**

     * 顶部显示与该 PDF 相关的问答记录与总结；
     * 底部为提问输入框（占位文案："Ask a question about this PDF..."）；
     * 文档 / 章节总结结果也展示在此区域。

### 6.3 关键功能与交互

#### 6.3.1 AI 回复格式支持（通用）

* 所有 AI 生成内容（贴纸、问答、总结）统一以 Markdown 文本形式返回；
* 前端通过 Markdown 渲染组件支持：

  * 标题、粗体 / 斜体、列表、链接、表格、引用块等完整 Markdown 语法；
  * LaTeX 数学公式：`$...$` / `\(...\)` 行内公式，`$$...$$` / `\[...\]` 块级公式（KaTeX 渲染）；
  * 代码高亮：三反引号代码块 + 语言标记（如 ` ```python`、` ```cpp` 等），行内代码使用单反引号。

> 与 01 / 03 / 04 保持一致：后端只返回 Markdown 文本，前端不直接渲染 HTML。

---

#### 6.3.2 自动讲解贴纸（Explain this page）

> 与原设计区别：不在打开 PDF 时自动生成，而是由用户显式点击按钮来触发「当前页自动讲解」。

**触发方式**

* 在右侧 AI 区域贴纸栏顶部展示一个主要按钮（或带图标按钮），文案建议：

  * `"Explain this page"` 或「解释当前页」；
* 当用户点击时：

  * 前端将当前视图的页码传给后端；
  * 后端对该页（或小范围页区间，如当前页 ±1）进行自动讲解，返回若干条自动贴纸；
  * 这些贴纸插入到贴纸栏中，与对应页在竖直方向大致对齐。

**PPT 风格 PDF 行为**

* 以「页」为单位；
* 模型自动识别当前页 2–5 个核心要点 / 区块；
* 每个要点生成一条自动讲解贴纸；
* 若本页内容非常密集，单页自动贴纸总数控制在约 5–6 条以内。

**长文本风格 PDF 行为**

* 按自然段落 + 语义分段切分本页内容；
* 若某段连续文本 > ~300 字，可进一步按 200–300 字拆成小块；
* 每块生成一条自动讲解贴纸；
* 同页贴纸总数同样限制在约 5–6 条以内。

**展示与交互**

* 自动贴纸在视觉上有明显区分：

  * 例如顶部有「Auto」或「自动讲解」标签 / 图标；
  * 使用较浅背景色，弱化“这是我主动问的”的感觉。
* 贴纸内容区高度有限（例如 300–400 px），超出部分内部滚动；
* 用户可对自动贴纸执行：

  * 折叠 / 展开；
  * 从贴纸中选中文本做进一步追问（生成手动贴纸）。

**持久化与重复访问**

* 首次点击按钮生成的自动贴纸会存储到后端；
* 再次打开该文件时：

  * 若该页已有已存自动贴纸，前端只需拉取并展示，**不会重复调用 AI**；
  * 用户可继续在此基础上用选中讲解 / 问答等功能。

---

#### 6.3.3 选中文本讲解贴纸 & 追问链（Manual）

**从 PDF 原文选中触发**

* 用户在左侧 PDF 中选中一段文字或公式附近文本：

  * 在选区附近显示悬浮气泡按钮「AI 讲解」；
  * 点击后：

    * 弹出短暂的 loading 状态；
    * 在右侧贴纸栏中，在该页对应的高度附近插入一条「手动贴纸」；
    * 贴纸结构：

      * 顶部小标签，如「From selection」或「选中文本讲解」；
      * 一个简短的原文片段（可截断到若干字符）；
      * AI 的讲解正文（Markdown）。

**从贴纸文本继续追问**

* 用户在贴纸正文中选中某句话或公式：

  * 同样弹出「AI 讲解」浮层；
  * 点击后：

    * 生成新贴纸，并紧挨选中来源的贴纸插入；
    * 新贴纸的 `parent` 指向上一条，形成 thread；
    * UI 上可展示轻微缩进 / 细线连接，体现「追问链」。

**排序与对齐**

* 自动贴纸按文档结构排序（按页 / 段落，从上到下）；
* 手动贴纸规则：

  * 若来自 PDF 原文：

    * 以锚点位置在该页贴纸列表中的相对高度插入；
  * 若来自某贴纸的追问：

    * 紧挨该贴纸向下插入，成为同一 thread 的后续节点；
* 整体滚动条为一个列表，按上述规则维护稳定顺序。

**折叠 / 展开与长度控制**

* 每条贴纸右上角有折叠图标（例如小箭头）；
* 折叠：

  * 保留头部标签 + 一行摘要（原文片段或讲解首行）；
* 展开：

  * 显示完整的 Markdown 内容；
  * 若内容超过设定高度，则在贴纸内部滚动；
* 折叠状态（folded）会写入后端并在重开文档时恢复。

---

#### 6.3.4 基于当前 PDF 的自由问答（Q&A）

**位置与布局**

* 位于右侧 AI 区域的下半部分；
* 分为两部分：

  * 上方：历史问答记录 / 总结卡片；
  * 下方：提问输入框 + 发送按钮。

**交互流程**

1. 用户在输入框中输入问题（例如“这章几个定理的关系是什么？”）；
2. 点击「Send」或按 Enter 提交；
3. 前端携带：

   * `courseId`、`fileId`；
   * 当前 `pageHint`（用户所在页）；
   * 当前会话 `sessionId`（如有）；
4. 后端基于当前 PDF（可结合缓存的分段向量索引）检索相关内容并生成回答；
5. 回答展示为气泡式卡片，包含：

   * Markdown 主体内容；
   * 引用区域（如「References: p.3, p.10」）；
   * 可选：点击页码可滚动到左侧对应页。

**与贴纸的区别**

* 问答主要用于**跨页 / 综合性问题**；
* 回答不会自动变成贴纸，避免混淆；
* 若用户希望把某个回答固化到某一页旁边（未来可选），可以考虑后续增加“保存为贴纸”能力（MVP 不做）。

---

#### 6.3.5 文档 / 章节总结入口

**入口位置**

* 可放在问答区域顶部的工具栏区域：

  * 「Summarize this document」
  * 「Summarize this section」
* 也可以在 PDF 工具栏增加「Summarize current section」按钮（可选）。

**交互流程**

* 文档总结：

  1. 用户点击「Summarize this document」；
  2. 前端调用对应 API；
  3. 返回结构化提纲后，在问答区域以一条「Summary Card」形式展示；
  4. 该卡片可折叠 / 展开，但不做成贴纸。
* 章节总结：

  1. 用户在 PDF 中选中一段页区间（或系统根据当前页 / 章节自动推断）；
  2. 点击「Summarize this section」；
  3. 返回内容同样以一条 summary 卡片展示。

**与课程级提纲（P6）的关系**

* P5 中的总结入口为「当前 PDF / 当前章节」级别；
* P6 为「课程级」提纲；
* 对课程提纲的入口（如「Generate course outline」）主要在 P4 / P6，P5 中可提供链接跳转。

---

#### 6.3.6 不可选文本 / 扫描件 PDF 的处理

**检测与标记**

* 上传时尝试检测 PDF 是否有有效文本层（可选中文本）；
* 若文本层基本为空，可在文件元信息中记录 `isScanned: true`。

**在 P5 中的表现**

* 左侧 PDF 阅读器仍正常显示页面（图片形式）；
* 右侧 AI 区域：

  * 贴纸栏顶部展示提示：

    * “This PDF seems to be a scanned document. AI explanations are not available for this file yet.”
  * 隐藏或禁用：

    * 「Explain this page」按钮；
    * 从 PDF 原文选中触发的「AI 讲解」入口（因为无法选中）；
  * 问答区域可选：

    * MVP 阶段建议也禁用基于该文件的问答，避免用户误解（因为无法可靠检索原文）。

---

#### 6.3.7 贴纸折叠、内部滚动与持久化

**折叠 / 展开**

* 每条贴纸右上角提供折叠控制；
* 折叠状态下：

  * 显示头部标签 + 一行摘要文本（例如第一行讲解或原文片段）；
* 展开状态下：

  * 显示完整 Markdown 内容；
* 状态切换：

  * 点击图标或贴纸左侧某个区域触发；
  * 状态变化需实时写回后端（或通过 debounced 更新）。

**内部滚动**

* 为避免右侧列表因单条贴纸太长而变得难以操作：

  * 设置贴纸内容区最大高度（例如 300–400 px）；
  * 超出部分以内嵌滚动条展示（而不是整体列表滚动）；
* 折叠状态不会出现滚动条。

**持久化行为**

* 贴纸结构中包含 `folded: boolean` 字段；
* 当用户再次打开该 PDF 时：

  * 所有贴纸按 `folded` 状态渲染；
  * 用户可以在已有基础上继续折叠 / 展开。

---

## 7. P6 课程级复习提纲页（`/courses/[courseId]/outline` 或弹层）

### 7.1 页面目标与入口

* **目标**：

  * 汇总课程下多份讲义 / 作业 / 考卷的总结结果；
  * 帮助用户在考前快速获得一份结构化复习提纲。
* **入口**：

  * P4 课程详情页右上角「Generate course outline」按钮；
  * P5 页面中可提供链接跳转到 P6（如在总结区域提供“View course outline”）。

### 7.2 布局结构（示意）

* 顶部：课程名称 + 「Course outline」
* 右上角：刷新 / 重新生成按钮（MVP 可选）
* 主体：树状 / 分组列表结构

  * 一级：章节 / 单元（如「Chapter 1: Limits and Continuity」）
  * 二级：小节 / 主题（如「1.1 Limit definition」）
  * 每个小节下可展示：

    * 核心概念 bullet 列表；
    * 关键公式（使用 LaTeX 渲染）；
    * 典型题型说明；
    * 可选：相关 PDF / 页码链接。

### 7.3 交互细节

* 生成逻辑（前端视角）：

  * 用户首次点击「Generate course outline」：

    * 若后端尚在生成 → 显示 loading / skeleton；
    * 完成后展示树状提纲；
  * 若课程资料更新较多，用户可点击「Regenerate outline」触发重新生成。
* 与 P5 的联动：

  * 从提纲到原文：

    * 点击某条提纲下的「View in PDF」或页码链接 → 跳转 P5，并定位到对应 PDF + 页码；
  * 从 P5 总结区域：

    * 可以提供入口「Open course outline」。

---

## 8. P7 账号配额与使用情况页（`/account/usage`）

### 8.1 页面目标与入口

* **目标**：向用户透明展示课程数量与四类 AI 配额使用情况，配合实验文案，引导合理使用而不过度强调付费。
* **入口**：

  * 全局导航右上角账号菜单中的「Usage / quotas」；
  * 当用户某类配额接近上限时，提示框中的「View details」链接。

### 8.2 布局结构（示意）

* 顶部：标题「Usage & quotas」
* 主体：若干卡片，每张卡片代表一个配额 / 统计维度：

  * 「Courses created」
  * 「Learning interactions」（学习过程交互组：选中讲解 / 追问 / 问答）
  * 「Document summaries」
  * 「Section summaries」
  * 「Course outlines」
* 每张卡片显示：

  * 当前使用数量 / 上限（如「23 / 50」）；
  * 简短说明文案（强调实验性质）；
  * 进度条或轻量视觉表示。

### 8.3 配额说明示例文案

* 课程数量：

  * `"For this experiment, you can create up to 6 courses."`
* 学习过程交互（learningInteractions）：

  * `"During this experiment, you can use AI explanations and Q&A up to N times per course."`
* 文档 / 章节总结 / 课程总结：

  * 类似结构，同时提示这是“本次实验的临时限制”。

### 8.4 与前端按钮状态的联动

* 当某一配额桶接近上限：

  * 在 P5 的相关按钮旁展示轻量提示；
  * Usage 页中对应卡片以颜色或进度条高亮。
* 当某一配额桶达到上限：

  * P5 对应功能按钮置灰，悬浮提示：

    * `"You’ve reached the usage limit for this type in this experiment."`
  * Usage 页中对应卡片显示「已达上限」。

---

## 9. 典型用户流程（跨页面）

> 基于原始流程 F1–F4 更新自动讲解 / 贴纸 / 配额细节。

### F1 创建课程并上传资料（首轮使用）

1. 用户访问 `/login`，若无账号，则从登录页跳转至 `/register` 注册新账号；
2. 注册成功后自动跳转 P3「My Courses」：

   * 页面显示空状态 + 「Create your first course」按钮；
3. 用户点击「New course」，在弹窗中输入课程名（必填）与学校 / 学期（可选），点击「Create」：

   * 创建成功后，新课程卡片出现在列表中；
4. 用户点击课程卡片进入 P4：

   * 初始显示为无文件状态，提示用户上传资料；
5. 用户点击「Upload PDF」按钮：

   * 选择本地若干 PDF 文件，逐个指定类型（Lecture / Homework / Exam / Other）；
   * 确认后开始上传并显示进度；
   * 上传完成后，按类型显示在对应分组中；
6. 用户点击任一 PDF 卡片进入 P5，开始阅读与 AI 学习。

---

### F2 考前冲刺生成课程级提纲

1. 用户登录后进入 P3，选择目标课程进入 P4；
2. 在 P4 中确认已上传本课程主要的 Lecture / Homework / Exam 资料；
3. 用户先在 P5 中对关键 PDF 生成文档 / 章节总结：

   * 打开某份讲义 PDF，在问答区域点击「Summarize this document」；
   * 对某些难点章节使用「Summarize this section」；
   * 在问答区域查看并理解这些总结；
4. 回到 P4，点击右上角「Generate course outline」：

   * 若是首次生成 → 跳转 P6，显示「Generating outline...」状态；
   * 加载完成后展示课程级提纲；
5. 用户浏览提纲：

   * 根据结构识别高频考点与薄弱章节；
   * 点击提纲中的「View in PDF」跳回 P5，对应查看原始讲义页面；
6. 若课程内容更新或新增了大量总结：

   * 用户可在 P6 中点击「Regenerate outline」刷新提纲。

---

### F3 在 PDF 内使用 AI 讲解与问答（整学期跟课场景）

1. 从 P3 进入目标课程的 P4 课程详情页，选择当周讲义 PDF，点击卡片进入 P5「PDF 阅读 & AI 学习页」。
2. P5 中：

   * 左侧阅读器默认展示最近阅读页（`lastReadPage`），若无记录则从第一页开始；
   * 右侧上半部分为空或显示已有贴纸（如之前生成过的自动讲解 / 手动贴纸），下半部分为问答区域。
3. 用户先想大致理解当前页：

   * 点击右侧贴纸栏顶部的「Explain this page」按钮；
   * 系统为当前页生成若干条自动讲解贴纸（按 PPT / 长文本不同策略处理）；
   * 贴纸显示本页主要内容、关键公式和简单解释。
4. 用户阅读一段推导，感觉理解困难：

   * 在 PDF 中选中相关段落 / 公式；
   * 悬浮气泡出现「AI 讲解」按钮；
   * 点击后，在右侧贴纸栏中、该段对应位置附近生成一条新的手动贴纸，展示原文片段 + AI 解释。
5. 用户对这条贴纸里的某句话仍有疑问：

   * 在贴纸正文中选中该句文本；
   * 再次点击浮层中的「AI 讲解」按钮；
   * 在这条贴纸后紧挨着出现一条新贴纸，形成一个追问链（thread），逐步深入解释。
6. 贴纸逐渐增多时：

   * 用户可以将已理解的贴纸折叠，只保留当前关注的几条展开；
   * 折叠状态在后端持久化，下次打开同一 PDF 时保持；
   * 单条贴纸内部可滚动，避免占用过多垂直空间。
7. 用户希望从局部抽离、整体掌握本页 / 本章内容：

   * 在问答区域点击「Summarize this section」或「Summarize this document」，查看结构化总结；
   * 如需进一步提问，可在问答区域继续发问，AI 答案可引用贴纸与 PDF 页面，并给出页码引用。
8. 第二天再次打开同一 PDF：

   * 左侧自动回到 `lastReadPage`；
   * 右侧恢复该页上所有贴纸（包括自动 & 手动）及折叠状态；
   * 用户可在原有 thread 基础上继续追问，或从新段落开始选中文本讲解；
   * 如果已经生成过「Explain this page」的自动贴纸，则不会再次调用 AI。

---

### F4 配额触顶时的体验

1. 用户在高频使用 AI 功能后，学习过程交互组配额（learningInteractions）接近上限：

   * 在 P5 右侧 AI 面板顶部或按钮附近显示轻量提示，如 `"You're close to the limit for AI explanations and Q&A in this experiment."`；
2. 用户继续触发：

   * 选中文本讲解；
   * 从贴纸继续追问；
   * 问答区域提问。
     若仍在配额内 → 正常执行；
     若已触顶 → 弹出提示对话框，内容类似：
   * `"You've reached the AI usage limit for interactive explanations and Q&A in this experiment. You can still read your PDFs and existing notes."`
     同时将对应按钮置灰，hover 时显示 tooltip。
3. 自动讲解（Explain this page）不计入 learningInteractions：

   * 即便互动配额触顶，只要自动讲解自身的频率限制未到，用户仍可继续点击「Explain this page」；
   * 若自动讲解也触达后端的频率限制，则在点击时给出单独提示（如“自动讲解今日使用次数已达上限”），但这属于后端限流策略。
4. 用户点击配额提示中的「View details」：

   * 跳转到 P7 账号配额页；
   * 在 P7 中对应卡片以颜色或进度条高亮显示已达上限的配额桶。
5. 即便配额触顶，用户仍可：

   * 浏览 PDF；
   * 查看所有历史贴纸（自动 / 手动）；
   * 查看已有的文档 / 章节 / 课程总结和提纲内容；
   * 不影响资料管理与基础阅读体验。

---

> 本文档聚焦页面结构与关键用户流程，具体视觉样式（色彩、排版、组件细节）将在设计阶段进一步细化，但应严格遵循 `01_light_prd.md` 中的 AI 能力定义与 `03_api_design.md` 中的接口约定，以及 `04_tech_and_code_style.md` 中的技术规范和统一渲染方案。
